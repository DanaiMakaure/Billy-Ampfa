<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Billy ü§ç</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{min-height:100vh;display:flex;justify-content:center;align-items:flex-start;background:#1B263B;overflow-x:hidden;color:#f5f1ed;padding-top:40px;position:relative;}
.card{width:90%;max-width:800px;padding:40px 30px;border-radius:30px;background:rgba(245,241,235,0.08);backdrop-filter:blur(20px);box-shadow:0 20px 60px rgba(0,0,0,0.5);text-align:center;position:relative;z-index:2;}
h1{font-family:'Playfair Display', serif;font-size:32px;margin-bottom:25px;color:#F8F1F1;}
p{line-height:1.7;font-size:17px;color:#ddd5cf;margin-bottom:25px;}
input, select{padding:12px;border-radius:25px;border:none;outline:none;text-align:center;width:220px;margin-top:15px;background:#f5f1ed;}
button{padding:12px 28px;border-radius:30px;border:none;margin:10px;cursor:pointer;background:#FF6F61;color:white;transition:0.3s;font-size:15px;}
button:hover{background:#E85C50;transform:scale(1.05);}
.hidden{display:none;}
.puzzle{display:grid;grid-template-columns:repeat(2,140px);grid-template-rows:repeat(2,140px);gap:4px;justify-content:center;margin-top:30px;}
.tile{width:140px;height:140px;background-size:280px 280px;border-radius:15px;cursor:pointer;transition:0.3s;}
.tile:hover{transform:scale(1.05);}
.puzzle-glow{box-shadow:0 0 60px rgba(255,255,255,0.8);transition:0.5s;}
.soft-error{color:#c97b84;margin-top:15px;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1000;}
.popup{background:white;padding:35px;border-radius:25px;text-align:center;width:350px;animation:pop 0.4s ease;}
.popup img{width:200px;border-radius:20px;margin-bottom:15px;}
@keyframes pop{from{transform:scale(0.7);opacity:0;}to{transform:scale(1);opacity:1;}}
.story-chapter{background:rgba(245,241,235,0.05);margin:20px auto;padding:25px;border-radius:20px;font-size:16px;line-height:1.7;text-align:left;display:none;}
#storyVideo{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:1;display:none;filter: brightness(0.4);}
.spotify{margin-top:20px;border-radius:16px;overflow:hidden;}
.activity-container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin-top:20px;}
.date-card{border-radius:20px;width:150px;text-align:center;cursor:pointer;transition:0.3s;}
.date-card img{width:100%;border-radius:15px;height:100px;object-fit:cover;}
.date-card.selected{box-shadow:0 0 20px #FF6F61;transform:scale(1.05);}
.date-pair-inputs{display:flex;flex-direction:column;gap:10px;margin-top:15px;}
.date-pair-inputs input{width:150px;}
.mandatory{ border: 2px solid #FF6F61; }
.mandatory::before{ content: "‚≠ê"; margin-right: 5px; }
</style>
</head>
<body>

<!-- Background Video -->
<audio id="bgMusic" loop>
<source src="https://open.spotify.com/track/5tQIUGDIpGmZerBVAosnRo" type="audio/mpeg">
</audio>

<!-- Story Video Background -->
<video id="storyVideo" autoplay muted loop>
    <source src="vid.mp4" type="video/mp4">
</video>

<div class="card">

<!-- ACCESS LOCK -->
<div id="lock">
<h1>Before You Enter ü§ç</h1>
<p>Type the day we had our first meetup:</p>
<input type="text" id="dateInput" placeholder="DD/MM/YYYY">
<br>
<button onclick="unlock()">Enter</button>
<div id="lockError" class="soft-error hidden">That's not our day‚Ä¶ try again.</div>
</div>

<!-- MAIN STAGE -->
<div id="mainStage" class="hidden fade-in">
<h1>For You ü§ç</h1>
<p>
Uhmm I don't even know the reason for this.  
But the lover girl in me wanted to create something soft and intentional just for you ü§ç.
</p>
<button onclick="startPuzzle()">üß© Put Us Together</button>
<button onclick="showStory()">üìñ Read Our Story</button>
<button onclick="showActivities()">‚ú® Plan Our Date</button>
<button onclick="reject()">üíî Choose The Other Side</button>
<div id="rejectMsg" class="soft-error hidden">That option doesn't exist here.</div>
</div>

<!-- PUZZLE - 3 pieces + 1 blank space (ALWAYS SOLVABLE) -->
<div id="stage2" class="hidden fade-in">
<h1>Put Us Back Together ü§ç</h1>
<p>It's easy‚Ä¶ just like choosing me should be ü•∞.</p>
<div class="puzzle" id="puzzle"></div>
<button onclick="shufflePuzzle()">üîÑ Shuffle</button>
<button onclick="backToMainFromPuzzle()">Go Back ü§ç</button>
</div>

<!-- GIFT -->
<div id="stage3" class="hidden fade-in">
<h1>You Did It ü§ç</h1>
<p id="giftText">You put us back together...</p>
<button onclick="backToMainFromGift()">Go Back ü§ç</button>
</div>

<!-- STORYBOOK -->
<div id="storyStage" class="hidden fade-in">
<h1>Our Story üìñ</h1>
<div id="storyContent"></div>
<div class="spotify">
    <iframe style="border-radius:16px"
        src="https://open.spotify.com/embed/track/5tQIUGDIpGmZerBVAosnRo"
        width="100%" height="80"
        frameBorder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
</div>
<p style="font-size:14px; color:#FF6F61; margin-top:15px;">Press Enter to read the next chapter ‚û°Ô∏è</p>
<button onclick="backToMainFromStory()">Back ü§ç</button>
</div>

<!-- ACTIVITIES - DINNER MANDATORY -->
<div id="activitiesStage" class="hidden fade-in">
<h1>‚ú® Plan Our Perfect Date</h1>
<p style="font-size:14px; margin-bottom:15px;">‚≠ê Dinner is mandatory - pick anything else you want!</p>
<div class="activity-container">
    <div class="date-card mandatory selected" data-type="Dinner/Lunch" onclick="selectActivity(this)">
        <img src="dinner.jpeg">
        <p>Dinner / Lunch ‚≠ê</p>
    </div>
    <div class="date-card" data-type="Painting" onclick="selectActivity(this)">
        <img src="paint.jpeg">
        <p>Painting</p>
    </div>
    <div class="date-card" data-type="Arcade" onclick="selectActivity(this)">
        <img src="arcade.jpeg">
        <p>Arcade</p>
    </div>
    <div class="date-card" data-type="Bike Ride" onclick="selectActivity(this)">
        <img src="bike.jpeg">
        <p>Bike Ride</p>
    </div>
    <div class="date-card" data-type="Wine Tasting" onclick="selectActivity(this)">
        <img src="wine.jpeg">
        <p>Wine Tasting</p>
    </div>
</div>

<div class="date-pair-inputs">
    <label>When are you free?</label>
    <input type="date" id="startDate">
    <input type="date" id="endDate">
</div>
<button onclick="submitProposal()">üíå Send Proposal</button>
<button onclick="backToMainFromActivities()">Go Back ü§ç</button>
</div>

</div>

<div id="overlay" class="hidden"></div>

<script>
// YOUR PUZZLE IMAGE - ONE PICTURE broken into 3 pieces with 1 blank space
let image = "us.JPEG";  // your beautiful photo of you two
let tiles = [], emptyIndex = 3;
let selectedActivities = new Set(['Dinner/Lunch']);

const storyContentArr=[
` The first time I saw you was at a competition. Honestly, I just thought you looked good üòè. I told my teammates, "There‚Äôs only one man here," and we all laughed. I wasn‚Äôt really paying attention to you,was too focused on my own stuff.`,
` Then came that ‚Äúcaught off guard‚Äù moment in the war room. I felt so dumb‚Ä¶ even more so when you saw me shaking! I hate last-minute chaos; I like to be on top of my game.`,
` By the final presentation, I thought, "Okay, let me just show what I know." After the awards ceremony, I was just sipping my drink, not expecting to bump into you‚Ä¶ and then there you were. And I thought, "Okay‚Ä¶uhmm he‚Äôs cute, definitely handsome and not in myüò≥." I may have kinda forced your contacts out of you‚Ä¶ don‚Äôt really remember exactly how that went.`,
` I really wanted to chat with you after that, but you were so nonchalant üòí. I decided to let it slide‚Ä¶ then, magically, you actually started talking! Nice. Definitely "whoever keeps me up at night," because you‚Äôre totally nocturnal .`,
` Fast forward to when we met properly. I was nervous, blubbering, thinking "what is this guy thinking?" or "will he ghost me?" üòÖ. But we kept talking anyway. Not to forget‚Ä¶ you have this talent for evading serious conversations which l dont exactly fancy welll till l kill you myself üòè.`,
` I wanted to see you before school started, worried you might forget me. I asked nicely, but you refused  because you wanted to host which was reasonable but all l wanted to see wassss YOUUUUU üò§. So I decided to surprise you instead which l really hope you didnt take offece in but well some of our best memories (at least according to me) are from that day üòá.`,
` I dont know when l will send this so l couldn't/cant/ wont be your Valentine but the lover girl in me couldn‚Äôt just sit around üòè. I got you a little something (well l am editing this now because l might have stumbled on something l thought you would like in the shops apart from the gift). Now the big question: should I deliver it myself , or courier it ?`
];


function unlock() {
    let input = document.getElementById("dateInput").value.trim();
    if (input === "30/12/2025") {
        document.getElementById("lock").classList.add("hidden");
        document.getElementById("mainStage").classList.remove("hidden");
        document.getElementById("lockError").classList.add("hidden");
    } else {
        document.getElementById("lockError").classList.remove("hidden");
    }
}

function reject() {
    document.getElementById("rejectMsg").classList.remove("hidden");
}

// PUZZLE FUNCTIONS - ALWAYS SOLVABLE!
function startPuzzle() {
    document.getElementById("mainStage").classList.add("hidden");
    document.getElementById("stage2").classList.remove("hidden");
    // Start from solved state then shuffle with VALID moves
    tiles = [0, 1, 2, 3];
    emptyIndex = 3;
    shufflePuzzle();
}

// Separate shuffle function that only makes valid moves
function shufflePuzzle() {
    // Start from solved state
    tiles = [0, 1, 2, 3];
    emptyIndex = 3;
    
    // Make a series of random VALID moves (like a real person playing)
    // 20-30 moves creates a nice shuffle that's definitely solvable
    const moves = 25 + Math.floor(Math.random() * 10); // 25-35 moves
    
    for (let m = 0; m < moves; m++) {
        // Find all valid moves (tiles adjacent to empty space)
        const validMoves = [];
        for (let i = 0; i < 4; i++) {
            if (i === emptyIndex) continue;
            const row = Math.floor(i / 2);
            const col = i % 2;
            const emptyRow = Math.floor(emptyIndex / 2);
            const emptyCol = emptyIndex % 2;
            // Check if adjacent (up, down, left, right)
            if (Math.abs(row - emptyRow) + Math.abs(col - emptyCol) === 1) {
                validMoves.push(i);
            }
        }
        
        // Pick a random valid move and swap with empty space
        if (validMoves.length > 0) {
            const move = validMoves[Math.floor(Math.random() * validMoves.length)];
            [tiles[move], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[move]];
            emptyIndex = move;
        }
    }
    
    // Render the shuffled puzzle
    renderPuzzle();
}

function renderPuzzle() {
    const puzzle = document.getElementById("puzzle");
    puzzle.innerHTML = "";
    
    tiles.forEach((value, index) => {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        
        if (value !== 3) {  // Image piece
            let x = (value % 2) * 140;
            let y = Math.floor(value / 2) * 140;
            tile.style.backgroundImage = `url(${image})`;
            tile.style.backgroundPosition = `-${x}px -${y}px`;
            tile.onclick = () => moveTile(index);
        } else {  // Blank space
            tile.style.background = "rgba(255,255,255,0.1)";
            tile.style.backdropFilter = "blur(4px)";
            tile.onclick = () => moveTile(index);
            emptyIndex = index;
        }
        puzzle.appendChild(tile);
    });
}

function moveTile(index) {
    // Check if clicked tile is adjacent to empty space
    const row = Math.floor(index / 2);
    const col = index % 2;
    const emptyRow = Math.floor(emptyIndex / 2);
    const emptyCol = emptyIndex % 2;
    
    if (Math.abs(row - emptyRow) + Math.abs(col - emptyCol) === 1) {
        // Swap with empty space
        [tiles[index], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[index]];
        emptyIndex = index;
        renderPuzzle();
        checkWin();
    }
}

function checkWin() {
    // Check if pieces are in correct order: 0,1,2 in positions 0,1,2 and 3 is blank
    if (tiles[0] === 0 && tiles[1] === 1 && tiles[2] === 2 && tiles[3] === 3) {
        document.getElementById("puzzle").classList.add("puzzle-glow");
        showPopup("üëèüëèüëè You did it! We're whole again! üëèüëèüëè");
        setTimeout(() => {
            document.getElementById("stage2").classList.add("hidden");
            document.getElementById("stage3").classList.remove("hidden");
            document.getElementById("giftText").innerHTML = `
            Your gift has been with me this whole time... üéÅ<br><br>
            Do you want me to bring it myself ü§ç or courier it üì¶?
            <br><br>
            <button onclick="comeWith()">Come With It ü§ç</button>
            <button onclick="courier()">Courier It üì¶</button>`;
        }, 1500);
    }
}

function showPopup(content) {
    const overlay = document.getElementById("overlay");
    overlay.classList.remove("hidden");
    overlay.innerHTML = `<div class="popup">${content}<button onclick="closePopup()">Close ü§ç</button></div>`;
}

function closePopup() {
    document.getElementById("overlay").classList.add("hidden");
}

function comeWith() {
    showPopup("<p style='color:#FF6F61; font-weight:600;'>Then I'll bring it myself‚Ä¶ ü§ç<br>wanna know when I'm free?</p>");
}

function courier() {
    showPopup("<p style='color:#FF6F61; font-weight:600;'>So you don't want to see this face? ü•∫<br>Fine‚Ä¶ but my heart is inside that box.</p>");
}

function backToMainFromPuzzle() {
    document.getElementById("stage2").classList.add("hidden");
    document.getElementById("mainStage").classList.remove("hidden");
}

function backToMainFromGift() {
    document.getElementById("stage3").classList.add("hidden");
    document.getElementById("mainStage").classList.remove("hidden");
}

// STORY FUNCTIONS
function showStory() {
    document.getElementById("mainStage").classList.add("hidden");
    document.getElementById("storyStage").classList.remove("hidden");
    document.getElementById("storyVideo").style.display = "block";
    
    const storyDiv = document.getElementById("storyContent");
    storyDiv.innerHTML = "";
    let currentChapter = 0;
    
    function showChapter() {
        storyDiv.innerHTML = ""; 
        let p = document.createElement("p"); 
        p.classList.add("story-chapter"); 
        p.style.display = "block";
        p.textContent = storyContentArr[currentChapter]; 
        storyDiv.appendChild(p);
    }
    
    showChapter();
    
    document.addEventListener("keydown", function handleEnter(e) {
        if (e.key === "Enter") {
            currentChapter++; 
            if (currentChapter < storyContentArr.length) {
                showChapter();
            } else {
                document.removeEventListener("keydown", handleEnter);
            }
        }
    });
}

function backToMainFromStory() {
    document.getElementById("storyStage").classList.add("hidden");
    document.getElementById("mainStage").classList.remove("hidden");
    document.getElementById("storyVideo").style.display = "none";
}

// ACTIVITIES FUNCTIONS - with mandatory dinner
function showActivities() {
    document.getElementById("mainStage").classList.add("hidden");
    document.getElementById("activitiesStage").classList.remove("hidden");
    // Make sure dinner is always selected
    document.querySelectorAll('.date-card').forEach(c => c.classList.remove('selected'));
    document.querySelector('.date-card.mandatory').classList.add('selected');
    selectedActivities = new Set(['Dinner/Lunch']);
}

function selectActivity(card) {
    const type = card.dataset.type;
    const isMandatory = card.classList.contains('mandatory');
    
    if (isMandatory) {
        // Dinner is always selected
        showPopup("‚≠ê Dinner is non-negotiable, baby! It's always included ü§ç");
        return;
    }
    
    if (selectedActivities.has(type)) {
        selectedActivities.delete(type);
        card.classList.remove('selected');
    } else {
        selectedActivities.add(type);
        card.classList.add('selected');
    }
}

function submitProposal() {
    const start = document.getElementById("startDate").value;
    const end = document.getElementById("endDate").value;
    
    if (!start || !end) {
        alert("Please select both dates!");
        return;
    }
    
    const activitiesList = Array.from(selectedActivities).join(', ');
    const message = `Hey ü§ç I'd love to spend time with you from ${start} to ${end}. We'll definitely have dinner together ‚≠ê, and also: ${activitiesList}. Can't wait!`;
    const url = `https://wa.me/0617215090?text=${encodeURIComponent(message)}`;
    window.open(url, "_blank");
}

function backToMainFromActivities() {
    document.getElementById("activitiesStage").classList.add("hidden");
    document.getElementById("mainStage").classList.remove("hidden");
}

// Initialize puzzle when page loads
window.onload = function() {
    // Pre-load the image to make sure it works
    let img = new Image();
    img.src = image;
};
</script>
</body>
</html>
